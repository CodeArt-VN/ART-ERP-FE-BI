<ion-header>
	<app-list-toolbar [pageConfig]="pageConfig" [selectedItems]="selectedItems" [query]="query" (add)="add()" (refresh)="refresh()" (export)="export()" (import)="import($event)" (help)="help()" (unselect)="unselect()" (archiveItems)="archiveItems()" (deleteItems)="deleteItems()" (changeBranch)="changeBranch($event)"></app-list-toolbar>
</ion-header>

<ion-content appScrollbarTheme class="scrollx">
	<ion-refresher [disabled]="!pageConfig.refresher" [disabled]="!pageConfig.refresher" slot="fixed" (ionRefresh)="refresh($event)">
		<ion-refresher-content></ion-refresher-content>
	</ion-refresher>
	<ion-fab *ngIf="pageConfig.isShowFeature" class="feature" vertical="top" horizontal="end" slot="fixed">
		<div class="ion-padding">

		</div>
	</ion-fab>

	<div class="ion-padding">
		<app-page-title [icon]="pageConfig.pageIcon" [title]="pageConfig.pageTitle" [remark]="pageConfig.pageRemark">
			<div rightContent class="mini-chart" [ngClass]="{'box-shadow': showFullChart}">
				<div class="mini-chart-control">
					<ion-button *ngIf="showFullChart" fill="clear" size="small" (click)="toggleChartFilter(true)">
						<ion-icon name="filter-outline"></ion-icon>
					</ion-button>
					<ion-button fill="clear" size="small" (click)="toggleMiniChart()">
						<ion-icon slot="icon-only" name="resize"></ion-icon>
					</ion-button>
				</div>
				<app-tabs-card 
					*ngIf="showFullChart"
					[tabs]="reportConfig.MeasureBy" 
					[type]="viewDimension"
					(onChange)="buildDataset($event)"
				></app-tabs-card>

				<div style="height: 100%; width: 100%;" class="box" id="{{elId}}"></div>
			</div>

		</app-page-title>

		<section class="table responsive box-shadow">
			<header class="bold">
				<div class="col-checkbox cell"></div>
				<div class="col-id cell">#</div>
				<div class="col-name cell" *ngFor="let c of reportConfig.CompareBy">
					{{c.Property | translate}}
				</div>

				<div class="col-number cell" *ngFor="let m of reportConfig.MeasureBy" [ngClass]="{selected: viewDimension == (m.Title || m.Property)}">
					{{(m.Title || m.Property) | translate}}
				</div>
				<div class="col-remark cell"></div>
			</header>
			<div class="table-body">
				<app-page-message [itemsLength]="items.length" [showSpinner]="pageConfig.showSpinner"></app-page-message>
				<ion-virtual-scroll [items]="items" approxItemHeight="27px" *ngIf="items.length && pageConfig.showSpinner==false">
					<ng-container *virtualItem="let i; let itemBounds = bounds; let j = index;">
						<div class="row" [ngClass]="{odd: j % 2 != 0}" [ngClass]="{selected: i.checked}">
							<div class="col-checkbox cell">
								<input (click)="changeSelection(i, $event)" class="c-checkbox" [(ngModel)]="i.checked" type="checkbox">
							</div>
							<div class="col-id cell">
								<a>{{j+1}}</a>
							</div>
							<div class="col-name cell" *ngFor="let c of reportConfig.CompareBy">
								{{i[c.Property]}}
							</div>
							<div class="col-number cell" *ngFor="let m of reportConfig.MeasureBy" [ngClass]="{selected: viewDimension == (m.Title || m.Property)}">
								<span>{{i[(m.Title || m.Property)] | number: '1.0-0'}}</span>
							</div>
							<div class="col-remark cell"></div>
						</div>
					</ng-container>
				</ion-virtual-scroll>
			</div>

		</section>
	</div>

	<ion-infinite-scroll color="primary" threshold="20%" (ionInfinite)="loadData($event)" [disabled]="!pageConfig.infiniteScroll || pageConfig.isEndOfData">
		<ion-infinite-scroll-content loadingSpinner="dots"></ion-infinite-scroll-content>
	</ion-infinite-scroll>
</ion-content>

<app-chart-filter
	[isOpen]="showFilterChart"
	(onCancel)="toggleChartFilter(false)"
></app-chart-filter>