<ion-header>
	<ion-toolbar>
		<ion-buttons slot="start" class="ion-hide-sm-down_">
			<ion-button color="dark" class="ion-hide-sm-down">
				Receipts Report
			</ion-button>
		</ion-buttons>

		<ion-buttons slot="end">
			<ion-button (click)="refresh()" title="{{'erp.app.pages.bi.dashboard.refresh' | translate}}">
				<ion-icon slot="icon-only" name="reload-outline"></ion-icon>
			</ion-button>

			<ion-button title="{{'erp.app.pages.bi.dashboard.show-feature' | translate}}" (click)="pageConfig.isShowFeature = !pageConfig.isShowFeature;">
				<ion-icon slot="icon-only" [name]="pageConfig.isShowFeature? 'close-outline':'list-circle-outline'">
				</ion-icon>
			</ion-button>

		</ion-buttons>
	</ion-toolbar>
</ion-header>

<ion-content appScrollbarTheme class="ion-padding">

	<ion-fab [hidden]="!pageConfig.isShowFeature" [ngClass]="{withSearch: pageConfig.isShowSearch}" class="feature" vertical="top" horizontal="end" slot="fixed">

		<!-- Component Query Filter -->
		<app-query-filter (changeFrequencyComp)="changeFrequency($event)" (changeDateFilterComp)="changeDateFilter($event)" (toogleBranchDatasetComp)="toogleBranchDataset($event)"></app-query-filter>

	</ion-fab>

	<div class="main-view" *ngIf="items.length">
		<div class="row-full shadow full-screen">
			<div>

				<!-- Chart -->
				<div class="ion-padding">
					<ion-grid>
						<ion-row class="hr-group">
							<ion-col size="12" size-sm="12" size-md="3" size-xl="3">
								<ng-container *ngIf="RevenueChartData.length">
									<app-line-chart [title]="'Revenue'" [data]="RevenueChartData"
										[label]="labelLineChart" [type]="typeLineChart"></app-line-chart>
								</ng-container>
							</ion-col>
							<ion-col size="12" size-sm="12" size-md="3" size-xl="3">
								<ng-container *ngIf="ReceiptsChartData.length">
									<app-line-chart [title]="'Receipts'" [data]="ReceiptsChartData"
										[label]="labelLineChart" [type]="typeLineChart"></app-line-chart>
								</ng-container>
							</ion-col>
							<ion-col size="12" size-sm="12" size-md="3" size-xl="3">
								<ng-container *ngIf="PaymentChartData.length">
									<app-pie-chart [ChartInfo]="Chart1" [ChartData]="PaymentChartData"></app-pie-chart>
								</ng-container>
							</ion-col>
							<ion-col size="12" size-sm="12" size-md="3" size-xl="3">
								<ng-container *ngIf="PaymentAmountChartData.length">
									<app-pie-chart [ChartInfo]="Chart2"
										[ChartData]="PaymentAmountChartData"></app-pie-chart>
								</ng-container>
							</ion-col>
						</ion-row>
					</ion-grid>
				</div>


				<!-- <app-pos-receipt-item [items]="items"></app-pos-receipt-item> -->

				<!-- List Receipts Report -->
				<div class="table-contain">
					<section class="table">
						<header class="bold">
							<div class="col-code cell">
								CreatedOn
								<ion-icon class="min-btn" *ngIf="sort.Name" [name]="sort.Name == 'Name'?'arrow-down': 'arrow-up'"></ion-icon>
								<ion-icon class="min-btn" (click)="pageConfig.isShowSearch = !pageConfig.isShowSearch" *ngIf="query.Name" name="search" color="primary"></ion-icon>
							</div>

							<div class="col-code cell">
								ReceiptsID
								<ion-icon class="min-btn" *ngIf="sort.Name" [name]="sort.Name == 'Name'?'arrow-down': 'arrow-up'"></ion-icon>
								<ion-icon class="min-btn" (click)="pageConfig.isShowSearch = !pageConfig.isShowSearch" *ngIf="query.Name" name="search" color="primary"></ion-icon>
							</div>

							<div class="col-code cell">
								Table
								<ion-icon class="min-btn" *ngIf="sort.Code" [name]="sort.Code == 'Code'?'arrow-down': 'arrow-up'"></ion-icon>
								<ion-icon class="min-btn" (click)="pageConfig.isShowSearch = !pageConfig.isShowSearch" *ngIf="query.Code" name="search" color="primary"></ion-icon>
							</div>

							<div class="col-code cell">
								Total Price
								<ion-icon class="min-btn" *ngIf="sort.Name" [name]="sort.Name == 'Name'?'arrow-down': 'arrow-up'"></ion-icon>
								<ion-icon class="min-btn" (click)="pageConfig.isShowSearch = !pageConfig.isShowSearch" *ngIf="query.Name" name="search" color="primary"></ion-icon>
							</div>

							<div class="col-code cell">
								Status
								<ion-icon class="min-btn" *ngIf="sort.Code" [name]="sort.Code == 'Code'?'arrow-down': 'arrow-up'"></ion-icon>
								<ion-icon class="min-btn" (click)="pageConfig.isShowSearch = !pageConfig.isShowSearch" *ngIf="query.Code" name="search" color="primary"></ion-icon>
							</div>
							
							<div class="col-name cell">
								Payment
								<ion-icon class="min-btn" *ngIf="sort.Code" [name]="sort.Code == 'Code'?'arrow-down': 'arrow-up'"></ion-icon>
								<ion-icon class="min-btn" (click)="pageConfig.isShowSearch = !pageConfig.isShowSearch" *ngIf="query.Code" name="search" color="primary"></ion-icon>
							</div>

							<div class="col-code cell">
								Type
								<ion-icon class="min-btn" *ngIf="sort.Code" [name]="sort.Code == 'Code'?'arrow-down': 'arrow-up'"></ion-icon>
								<ion-icon class="min-btn" (click)="pageConfig.isShowSearch = !pageConfig.isShowSearch" *ngIf="query.Code" name="search" color="primary"></ion-icon>
							</div>

							<div class="col-code cell">
								Payment Status
								<ion-icon class="min-btn" *ngIf="sort.Code" [name]="sort.Code == 'Code'?'arrow-down': 'arrow-up'"></ion-icon>
								<ion-icon class="min-btn" (click)="pageConfig.isShowSearch = !pageConfig.isShowSearch" *ngIf="query.Code" name="search" color="primary"></ion-icon>
							</div>

							<div class="col-name cell">
								Payment By
								<ion-icon class="min-btn" *ngIf="sort.Code" [name]="sort.Code == 'Code'?'arrow-down': 'arrow-up'"></ion-icon>
								<ion-icon class="min-btn" (click)="pageConfig.isShowSearch = !pageConfig.isShowSearch" *ngIf="query.Code" name="search" color="primary"></ion-icon>
							</div>

							<div class="col-name cell">
								Created By
								<ion-icon class="min-btn" *ngIf="sort.Code" [name]="sort.Code == 'Code'?'arrow-down': 'arrow-up'"></ion-icon>
								<ion-icon class="min-btn" (click)="pageConfig.isShowSearch = !pageConfig.isShowSearch" *ngIf="query.Code" name="search" color="primary"></ion-icon>
							</div>

							<div class="col-name cell">
								Customer
								<ion-icon class="min-btn" *ngIf="sort.Code" [name]="sort.Code == 'Code'?'arrow-down': 'arrow-up'"></ion-icon>
								<ion-icon class="min-btn" (click)="pageConfig.isShowSearch = !pageConfig.isShowSearch" *ngIf="query.Code" name="search" color="primary"></ion-icon>
							</div>

							<div class="col-code cell">
								#Customer
								<ion-icon class="min-btn" *ngIf="sort.Code" [name]="sort.Code == 'Code'?'arrow-down': 'arrow-up'"></ion-icon>
								<ion-icon class="min-btn" (click)="pageConfig.isShowSearch = !pageConfig.isShowSearch" *ngIf="query.Code" name="search" color="primary"></ion-icon>
							</div>

							<div class="col-code cell">
								Action
								<ion-icon class="min-btn" *ngIf="sort.Code" [name]="sort.Code == 'Code'?'arrow-down': 'arrow-up'"></ion-icon>
								<ion-icon class="min-btn" (click)="pageConfig.isShowSearch = !pageConfig.isShowSearch" *ngIf="query.Code" name="search" color="primary"></ion-icon>
							</div>
						</header>
	
						<app-page-message [itemsLength]="items.length" [showSpinner]="pageConfig.showSpinner"></app-page-message>
						<ion-virtual-scroll [items]="items" approxItemHeight="27px">
							<ng-container *virtualItem="let i; let itemBounds = bounds; let idx = index;">
								<div class="row" [ngClass]="{selected: i.checked}">
			
							<div class="col-code cell">
								{{i.CreatedOnText}}
							</div>

							<div class="col-code cell">
								{{i.ReceiptID}}
								<a [href]="'#/'+'pos-order/'+i.ReceiptID" (click)="nav('pos-order/'+i.ReceiptID,'forward')">
									<ion-icon name="open-outline"></ion-icon>
								</a>
							</div>

							<div class="col-code cell">
								{{i.Table}}
							</div>

							<div class="col-code cell">
								{{i.TotalPriceText}}
							</div>

							<div class="col-code cell">
								{{i.Status}}
							</div>
							
							<div class="col-name cell payments">
								<ng-container *ngFor="let ip of i.Payments">
									<span>{{ip.AmountText}}</span>
								</ng-container>
							</div>

							<div class="col-code cell payments">
								<ng-container *ngFor="let ip of i.Payments">
									<span>{{ip.TypeText}} {{ip.SubType ? ' | ' + ip.SubType : ''}} {{ip.IsRefundTransaction ? ' | Refund' : ''}}</span>
								</ng-container>
							</div>

							<div class="col-code cell payments">
								<ng-container *ngFor="let ip of i.Payments">
									<span>{{ip.PaymentStatus}}</span>
								</ng-container>
							</div>

							<div class="col-name cell payments">
								<ng-container *ngFor="let ip of i.Payments">
									<span>{{ip.PaymentBy}}</span>
								</ng-container>
							</div>

							<div class="col-name cell">
								{{i.CreatedBy}}
							</div>

							<div class="col-name cell">
								{{i.Customer}}
							</div>

							<div class="col-code cell">
								{{i.NumberOfGuests}}
							</div>

							<div class="col-code cell">
								<ion-button><ion-icon name="print"></ion-icon></ion-button>
							</div>
								</div>
							</ng-container>
						</ion-virtual-scroll>

						<ion-infinite-scroll color="primary" threshold="20%" (ionInfinite)="loadData($event)" [disabled]="!pageConfig.infiniteScroll || pageConfig.isEndOfData">
							<ion-infinite-scroll-content loadingSpinner="dots"></ion-infinite-scroll-content>
						</ion-infinite-scroll>

	
					</section>
				</div>



			</div>
		</div>
	</div>
	<app-page-message [itemsLength]="items.length" [showSpinner]="pageConfig.showSpinner"></app-page-message>
</ion-content>