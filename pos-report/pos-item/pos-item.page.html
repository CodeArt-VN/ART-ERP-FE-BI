<ion-header>
	<ion-toolbar>
		<ion-buttons slot="start" class="ion-hide-sm-down_">
			<ion-button color="dark" class="ion-hide-sm-down">
				Product Reports
			</ion-button>
		</ion-buttons>

		<ion-buttons slot="end">
			<ion-button (click)="refresh()" title="{{'erp.app.pages.bi.dashboard.refresh' | translate}}">
				<ion-icon slot="icon-only" name="reload-outline"></ion-icon>
			</ion-button>

			<ion-button title="{{'erp.app.pages.bi.dashboard.show-feature' | translate}}" (click)="pageConfig.isShowFeature = !pageConfig.isShowFeature;">
				<ion-icon slot="icon-only" [name]="pageConfig.isShowFeature? 'close-outline':'list-circle-outline'">
				</ion-icon>
			</ion-button>

		</ion-buttons>
	</ion-toolbar>
</ion-header>

<ion-content appScrollbarTheme class="ion-padding">

	<ion-fab [hidden]="!pageConfig.isShowFeature" [ngClass]="{withSearch: pageConfig.isShowSearch}" class="feature" vertical="top" horizontal="end" slot="fixed">

		<!-- Component Query Filter -->
		<app-query-filter (changeFrequencyComp)="changeFrequency($event)" (changeDateFilterComp)="changeDateFilter($event)" (toogleBranchDatasetComp)="toogleBranchDataset($event)"></app-query-filter>

	</ion-fab>

	<div class="main-view" *ngIf="items.length">
		<div class="row-full shadow full-screen">
			<div *ngIf="segmentView == 's1'">

				<!-- Chart -->
				<div class="ion-padding">
					<ion-grid>
						<ion-row class="hr-group">
							<ion-col size="12" size-sm="12" size-md="6" size-xl="6">
								<ng-container *ngIf="items.length">
									<app-bar-chart [Title]="'Top Selling Products'" [Label]="topSellingProductLabel" [Data]="topSellingProductData"></app-bar-chart>
									<!-- <app-pie-chart [ChartInfo]="Chart1" [ChartData]="topSellingProduct"></app-pie-chart> -->
								</ng-container>
								
							</ion-col>
							<ion-col size="12" size-sm="12" size-md="6" size-xl="6">
								<ng-container *ngIf="items.length">
									<app-pie-chart [ChartInfo]="Chart2" [ChartData]="topRevenueProducts"></app-pie-chart>
								</ng-container>
							</ion-col>
						</ion-row>
					</ion-grid>
				</div>
				<div class="table-contain">
					<section class="table">
						<header class="bold">
							<div class="col-code cell" (click)="sortToggle('Name')">
								Ordered Amount
								<ion-icon class="min-btn" *ngIf="sort.Name" [name]="sort.Name == 'Name'?'arrow-down': 'arrow-up'"></ion-icon>
								<ion-icon class="min-btn" (click)="pageConfig.isShowSearch = !pageConfig.isShowSearch" *ngIf="query.Name" name="search" color="primary"></ion-icon>
							</div>

							<div class="col-code cell" (click)="sortToggle('Name')">
								Current Stock
								<ion-icon class="min-btn" *ngIf="sort.Name" [name]="sort.Name == 'Name'?'arrow-down': 'arrow-up'"></ion-icon>
								<ion-icon class="min-btn" (click)="pageConfig.isShowSearch = !pageConfig.isShowSearch" *ngIf="query.Name" name="search" color="primary"></ion-icon>
							</div>

							<div class="col-code cell" (click)="sortToggle('Name')">
								Product Id
								<ion-icon class="min-btn" *ngIf="sort.Name" [name]="sort.Name == 'Name'?'arrow-down': 'arrow-up'"></ion-icon>
								<ion-icon class="min-btn" (click)="pageConfig.isShowSearch = !pageConfig.isShowSearch" *ngIf="query.Name" name="search" color="primary"></ion-icon>
							</div>

							<div class="col-name cell" (click)="sortToggle('Name')">
								Product
								<ion-icon class="min-btn" *ngIf="sort.Name" [name]="sort.Name == 'Name'?'arrow-down': 'arrow-up'"></ion-icon>
								<ion-icon class="min-btn" (click)="pageConfig.isShowSearch = !pageConfig.isShowSearch" *ngIf="query.Name" name="search" color="primary"></ion-icon>
							</div>

							<div class="col-code cell" (click)="sortToggle('Code')">
								Price
								<ion-icon class="min-btn" *ngIf="sort.Code" [name]="sort.Code == 'Code'?'arrow-down': 'arrow-up'"></ion-icon>
								<ion-icon class="min-btn" (click)="pageConfig.isShowSearch = !pageConfig.isShowSearch" *ngIf="query.Code" name="search" color="primary"></ion-icon>
							</div>
							
							<div class="col-code cell" (click)="sortToggle('Code')">
								Takeaway Price
								<ion-icon class="min-btn" *ngIf="sort.Code" [name]="sort.Code == 'Code'?'arrow-down': 'arrow-up'"></ion-icon>
								<ion-icon class="min-btn" (click)="pageConfig.isShowSearch = !pageConfig.isShowSearch" *ngIf="query.Code" name="search" color="primary"></ion-icon>
							</div>

							<div class="col-code cell" (click)="sortToggle('Code')">
								Delivery Price
								<ion-icon class="min-btn" *ngIf="sort.Code" [name]="sort.Code == 'Code'?'arrow-down': 'arrow-up'"></ion-icon>
								<ion-icon class="min-btn" (click)="pageConfig.isShowSearch = !pageConfig.isShowSearch" *ngIf="query.Code" name="search" color="primary"></ion-icon>
							</div>

							<div class="col-code cell" (click)="sortToggle('Code')">
								VAT
								<ion-icon class="min-btn" *ngIf="sort.Code" [name]="sort.Code == 'Code'?'arrow-down': 'arrow-up'"></ion-icon>
								<ion-icon class="min-btn" (click)="pageConfig.isShowSearch = !pageConfig.isShowSearch" *ngIf="query.Code" name="search" color="primary"></ion-icon>
							</div>

							<div class="col-code cell" (click)="sortToggle('Code')">
								Total Revenue
								<ion-icon class="min-btn" *ngIf="sort.Code" [name]="sort.Code == 'Code'?'arrow-down': 'arrow-up'"></ion-icon>
								<ion-icon class="min-btn" (click)="pageConfig.isShowSearch = !pageConfig.isShowSearch" *ngIf="query.Code" name="search" color="primary"></ion-icon>
							</div>

							<div class="col-code cell" (click)="sortToggle('Code')">
								Cost
								<ion-icon class="min-btn" *ngIf="sort.Code" [name]="sort.Code == 'Code'?'arrow-down': 'arrow-up'"></ion-icon>
								<ion-icon class="min-btn" (click)="pageConfig.isShowSearch = !pageConfig.isShowSearch" *ngIf="query.Code" name="search" color="primary"></ion-icon>
							</div>

							<div class="col-code cell" (click)="sortToggle('Code')">
								Profit
								<ion-icon class="min-btn" *ngIf="sort.Code" [name]="sort.Code == 'Code'?'arrow-down': 'arrow-up'"></ion-icon>
								<ion-icon class="min-btn" (click)="pageConfig.isShowSearch = !pageConfig.isShowSearch" *ngIf="query.Code" name="search" color="primary"></ion-icon>
							</div>
						</header>
						<ion-virtual-scroll [items]="items" approxItemHeight="27px">
							<ng-container *virtualItem="let i; let itemBounds = bounds; let idx = index;">
									<div class="row" [ngClass]="{selected: i.checked}">
			
										<div class="col-code cell">
											{{i.OrderedAmount}}
										</div>
			
										<div class="col-code cell">
											{{i.CurrentStock}}
										</div>
			
										<div class="col-code bold cell">
											{{i.ProductID}}
										</div>
			
										<div class="col-name cell" (click)="nav('item/'+i.ProductID,'forward')">
											{{i.Product}}
										</div>
			
										<div class="col-code cell">
											{{i.PriceText}}
										</div>
			
										<div class="col-code cell">
											{{i.TakeawayPriceText}}
										</div>
			
										<div class="col-code cell">
											{{i.DeliveryPriceText}}
										</div>
			
										<div class="col-code cell">
											{{i.VATText}}
										</div>
			
										<div class="col-code bold cell">
											{{i.TotalRevenueText}}
										</div>
			
										<div class="col-code cell">
											{{i.Cost}}
										</div>
			
										<div class="col-code cell">
											{{i.Profit}}
										</div>
									</div>
							</ng-container>
						</ion-virtual-scroll>

					</section>
				</div>
			</div>
		</div>
	</div>
	<app-page-message [itemsLength]="items.length" [showSpinner]="pageConfig.showSpinner"></app-page-message>
</ion-content>
